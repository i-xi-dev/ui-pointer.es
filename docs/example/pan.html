<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Panning</title>
    <style>
*.test-container {
  direction: ltr !important;
  --scroller-w: 300px;
  --scroller-h: 300px;
  --content-w: 1000px;
  --content-h: 1000px;
  column-gap: 8px;
  display: grid;
  grid-template-columns: var(--scroller-w) auto;
  grid-template-rows: var(--scroller-h) auto;
  margin: 100px auto;
  row-gap: 8px;
  width: max-content;
  writing-mode: horizontal-tb !important;
}
*.test-scrollbar {
  background-color: #474747;
  visibility: hidden;
}
*.test-scroller.xx-active ~ *.test-scrollbar {
  visibility: visible;
}
*.test-scrollbar#ScrollbarX {
  grid-column: 1;
  grid-row: 2;
  height: 2px;
  width: 0;
}
*.test-scrollbar#ScrollbarY {
  grid-column: 2;
  grid-row: 1;
  height: 0;
  width: 2px;
}
*.test-scroller {
  background-color: #8f9a96;
  box-shadow: 0 0 0 2px gray;
  cursor: default;
  height: var(--scroller-h);
  grid-column: 1;
  grid-row: 1;
  overflow: hidden;
  position: relative;
  width: var(--scroller-w);
}
*.test-scroller.xx-active {
  box-shadow: 0 0 0 4px gray;
  cursor: move;
}
*.test-content {
  background-image: linear-gradient(to bottom, #fff 0%, #fff0 50%, #0000 50%, #000 100%),
  linear-gradient(to right, red 0%, yellow 16.66%, lime 33.33%, aqua 50%, blue 66.66%, fuchsia 83.33%, red 100%);
  height: var(--content-h);
  width: var(--content-w);
}
dl > div {
  display: flex;
  padding-inline-start: 50px;
}
dt {
  text-align: end;
}
dd {
  margin-inline-start: 1ch;
}
    </style>
    <script type="module">
import { PointerObserver } from "https://unpkg.com/@i-xi-dev/ui-pointer@0.0.1-alpha-12/dist/index.js";
const testScroller = document.getElementById("TestScroller");
const scrollbarX = document.getElementById("ScrollbarX");
const scrollbarY = document.getElementById("ScrollbarY");
const outputX = document.getElementById("OutputX");
const outputY = document.getElementById("OutputY");
const testScrollportW = testScroller.offsetWidth;
const testScrollportH = testScroller.offsetHeight;
const testContentW = testScroller.scrollWidth;
const testContentH = testScroller.scrollHeight;
const maxScrollLeft = testContentW - testScrollportW;
const maxScrollTop = testContentH - testScrollportH;
const indicatorWidth = testScrollportW * (testScrollportW / testContentW);
const indicatorHeight = testScrollportH * (testScrollportH / testContentH);

function updateIndicator() {
  scrollbarX.style.setProperty("width", `${indicatorWidth}px`);
  scrollbarY.style.setProperty("height", `${indicatorHeight}px`);
  const rateX = testScroller.scrollLeft / maxScrollLeft;
  const rateY = testScroller.scrollTop / maxScrollTop;
  scrollbarX.style.setProperty("margin-left", `${(testScrollportW - indicatorWidth) * rateX}px`);
  scrollbarY.style.setProperty("margin-top", `${(testScrollportH - indicatorHeight) * rateY}px`);

  outputX.value = (rateX * 100).toFixed(2) + "%";
  outputY.value = (rateY * 100).toFixed(2) + "%";
}

function onprogress(activity, trace) {
  if (trace.inContact === true) {
    testScroller.classList.add("xx-active");

    testScroller.scrollBy(-trace.movementX, -trace.movementY);
    updateIndicator();
  }
  else {
    testScroller.classList.remove("xx-active");
  }
}



const observer = new PointerObserver(async (activity) => {
  console.log(`[START] pointerId:${activity.pointer.id}, startTime:${activity.startTime}`);

  for await (const trace of activity) {
    //console.log(JSON.stringify(trace), JSON.stringify(activity));
    onprogress(activity, trace);
  }

  console.log(`[END] pointerId:${activity.pointer.id}, duration:${activity.duration}`);
  console.log(activity);
}, {});
observer.observe(testScroller);
    </script>
  </head>
  <body>
    <div class="test-container">
      <div class="test-scroller" id="TestScroller">
        <div class="test-content"></div>
      </div>
      <div class="test-scrollbar" id="ScrollbarX"></div>
      <div class="test-scrollbar" id="ScrollbarY"></div>
    </div>
    <dl>
      <div>
        <dt>x</dt>
        <dd><output id="OutputX">0.00%</output></dd>
      </div>
      <div>
        <dt>y</dt>
        <dd><output id="OutputY">0.00%</output></dd>
      </div>
    </dl>
  </body>
</html>
